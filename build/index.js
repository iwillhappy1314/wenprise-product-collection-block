(()=>{"use strict";const e=window.wp.components,t=window.wp.i18n,o=[{name:"desktop",icon:"dashicons-desktop"},{name:"tablet",icon:"dashicons-tablet"},{name:"mobile",icon:"dashicons-smartphone"}],l={Desktop:"desktop",Tablet:"tablet",Mobile:"mobile"},n=window.ReactJSXRuntime,a=({selectedDevice:e,onChange:t})=>{const l={padding:0,minWidth:"16px",height:"16px",background:"transparent",border:"none",cursor:"pointer"};return(0,n.jsx)("div",{className:"wprs-device-switcher",style:{display:"flex"},children:o.map((o=>(0,n.jsx)("button",{style:l,onClick:()=>t(o.name),children:(0,n.jsx)("span",{className:`dashicons ${o.icon}`,style:{minWidth:"16px",height:"16px",fontSize:"16px",color:e===o.name?"#007cba":"#949494"}})},o.name)))})},i=window.wp.element,r=window.wp.compose,c=window.wp.data,s=()=>{const[e,t]=(0,i.useState)("desktop"),o=(0,r.useViewportMatch)("medium","<"),n=(0,r.useViewportMatch)("small","<");return(0,i.useEffect)((()=>{t(n?"mobile":o?"tablet":"desktop")}),[o,n]),(0,i.useEffect)((()=>{const e=(0,c.subscribe)((()=>{try{const e=(0,c.select)("core/edit-post");if(e&&"function"==typeof e.__experimentalGetPreviewDeviceType){const o=e.__experimentalGetPreviewDeviceType();o&&l[o]&&t(l[o])}}catch(e){console.error("预览设备类型获取失败:",e)}}));return()=>e()}),[]),{device:e,handleDeviceChange:e=>{t(e);try{const t={desktop:"Desktop",tablet:"Tablet",mobile:"Mobile"},o=(0,c.dispatch)("core/edit-post");o&&"function"==typeof o.__experimentalSetPreviewDeviceType&&o.__experimentalSetPreviewDeviceType(t[e])}catch(e){console.error("设置预览设备类型失败:",e)}}}},p=({attributes:o,setAttributes:l})=>{const{device:i,handleDeviceChange:r}=s(),{perPage:c,perPageTablet:p,perPageMobile:u,gap:d,gapTablet:m,gapMobile:b,pagination:g,arrows:x}=o;return(0,n.jsxs)(e.PanelBody,{title:(0,t.__)("轮播设置"),initialOpen:!0,children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",marginBottom:"0.5rem"},children:[(0,n.jsx)("label",{style:{minWidth:"100px"},children:(0,t.__)("每页显示数量")}),(0,n.jsx)(a,{selectedDevice:i,onChange:r})]}),"desktop"===i&&(0,n.jsx)(e.RangeControl,{value:c,onChange:e=>l({perPage:e}),min:1,max:8}),"tablet"===i&&(0,n.jsx)(e.RangeControl,{value:p,onChange:e=>l({perPageTablet:e}),min:1,max:6}),"mobile"===i&&(0,n.jsx)(e.RangeControl,{value:u,onChange:e=>l({perPageMobile:e}),min:1,max:4}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",marginBottom:"0.5rem"},children:[(0,n.jsx)("label",{style:{minWidth:"100px"},children:(0,t.__)("间距")}),(0,n.jsx)(a,{selectedDevice:i,onChange:r})]}),"desktop"===i&&(0,n.jsx)(e.TextControl,{value:d,onChange:e=>l({gap:e}),help:(0,t.__)("支持 rem、em、px 等单位，如：2rem")}),"tablet"===i&&(0,n.jsx)(e.TextControl,{value:m,onChange:e=>l({gapTablet:e}),help:(0,t.__)("支持 rem、em、px 等单位，如：2rem")}),"mobile"===i&&(0,n.jsx)(e.TextControl,{value:b,onChange:e=>l({gapMobile:e}),help:(0,t.__)("支持 rem、em、px 等单位，如：2rem")}),(0,n.jsx)(e.ToggleControl,{label:(0,t.__)("显示分页器"),checked:g,onChange:e=>l({pagination:e})}),(0,n.jsx)(e.ToggleControl,{label:(0,t.__)("显示箭头"),checked:x,onChange:e=>l({arrows:e})})]})},u=({attributes:o,setAttributes:l})=>{const{device:i,handleDeviceChange:r}=s(),{columns:c,tabletColumns:p,mobileColumns:u,columnGap:d,tabletColumnGap:m,mobileColumnGap:b,rowGap:g,tabletRowGap:x,mobileRowGap:w,productsCount:y}=o;return(0,n.jsxs)(e.PanelBody,{title:(0,t.__)("布局设置","wenprise-product-collection"),initialOpen:"carousel"!==o.displayStyle,children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",marginBottom:"0.5rem"},children:[(0,n.jsx)("label",{style:{minWidth:"100px"},children:(0,t.__)("设备","wenprise-product-collection")}),(0,n.jsx)(a,{selectedDevice:i,onChange:r})]}),"desktop"===i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.RangeControl,{label:(0,t.__)("列数","wenprise-product-collection"),value:c,onChange:e=>l({columns:e}),min:1,max:6}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("列间距","wenprise-product-collection")+" (px)",value:d,onChange:e=>l({columnGap:e}),min:0,max:100}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("行间距","wenprise-product-collection")+" (px)",value:g,onChange:e=>l({rowGap:e}),min:0,max:100})]}),"tablet"===i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.RangeControl,{label:(0,t.__)("列数","wenprise-product-collection"),value:p,onChange:e=>l({tabletColumns:e}),min:1,max:4}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("列间距","wenprise-product-collection")+" (px)",value:m,onChange:e=>l({tabletColumnGap:e}),min:0,max:80}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("行间距","wenprise-product-collection")+" (px)",value:x,onChange:e=>l({tabletRowGap:e}),min:0,max:80})]}),"mobile"===i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.RangeControl,{label:(0,t.__)("列数","wenprise-product-collection"),value:u,onChange:e=>l({mobileColumns:e}),min:1,max:2}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("列间距","wenprise-product-collection")+" (px)",value:b,onChange:e=>l({mobileColumnGap:e}),min:0,max:50}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("行间距","wenprise-product-collection")+" (px)",value:w,onChange:e=>l({mobileRowGap:e}),min:0,max:50})]}),(0,n.jsx)(e.RangeControl,{label:(0,t.__)("产品数量","wenprise-product-collection"),value:y,onChange:e=>l({productsCount:e}),min:1,max:48})]})},{registerBlockType:d}=wp.blocks,{InspectorControls:m}=wp.blockEditor,{PanelBody:b,SelectControl:g}=wp.components,{useState:x,useEffect:w}=wp.element,{apiFetch:y}=wp,{__}=wp.i18n,h=wp.serverSideRender;d("wenprise/product-collection",{title:__("Product Collection","wenprise-product-collection"),icon:"grid-view",category:"wenprise-blocks",attributes:{taxonomyType:{type:"string",default:"product_tag"},tagId:{type:"string",default:""},displayStyle:{type:"string",default:"grid"},columns:{type:"number",default:4},tabletColumns:{type:"number",default:3},mobileColumns:{type:"number",default:2},columnGap:{type:"number",default:32},tabletColumnGap:{type:"number",default:24},mobileColumnGap:{type:"number",default:16},rowGap:{type:"number",default:32},tabletRowGap:{type:"number",default:24},mobileRowGap:{type:"number",default:16},productsCount:{type:"number",default:12},perPage:{type:"number",default:4},perPageTablet:{type:"number",default:2},perPageMobile:{type:"number",default:1},gap:{type:"string",default:"2rem"},gapTablet:{type:"string",default:"1.5rem"},gapMobile:{type:"string",default:"1rem"},pagination:{type:"boolean",default:!0},arrows:{type:"boolean",default:!0}},edit:function(e){const{attributes:t,setAttributes:o}=e,[l,a]=x([]),[i,r]=x(!1),c=[{label:__("Product Tags","wenprise-product-collection"),value:"product_tag"},{label:__("Product Categories","wenprise-product-collection"),value:"product_cat"},{label:__("Product Collections","wenprise-product-collection"),value:"product_collection"}],s={product_tag:__("Tag","wenprise-product-collection"),product_cat:__("Category","wenprise-product-collection"),product_collection:__("Collection","wenprise-product-collection")};w((()=>{t.taxonomyType&&d(t.taxonomyType)}),[t.taxonomyType]);const d=async e=>{r(!0);try{const t=(await y({path:`/wp/v2/${e}?per_page=100`})).map((e=>({label:e.name,value:e.id.toString()})));a(t)}catch(e){console.error("Error loading taxonomy terms:",e),a([])}r(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m,{children:[(0,n.jsxs)(b,{title:__("区块设置","wenprise-product-collection"),children:[(0,n.jsx)(g,{label:__("Select Taxonomy","wenprise-product-collection"),value:t.taxonomyType,options:c,onChange:e=>{o({taxonomyType:e,tagId:""})}}),(0,n.jsx)(g,{label:__("Select","wenprise-product-collection")+" "+s[t.taxonomyType],value:t.tagId,options:[{label:__("Please select","wenprise-product-collection"),value:""},...l],onChange:e=>o({tagId:e})})]}),(0,n.jsx)(b,{title:__("显示样式","wenprise-product-collection"),children:(0,n.jsx)(g,{label:__("显示样式","wenprise-product-collection"),value:t.displayStyle,options:[{value:"grid",label:__("网格","wenprise-product-collection")},{value:"list",label:__("列表","wenprise-product-collection")},{value:"carousel",label:__("轮播","wenprise-product-collection")}],onChange:e=>o({displayStyle:e})})}),"carousel"===t.displayStyle&&(0,n.jsx)(p,{attributes:t,setAttributes:o}),("grid"===t.displayStyle||"list"===t.displayStyle)&&(0,n.jsx)(u,{attributes:t,setAttributes:o})]}),(0,n.jsx)("div",{className:`wc-block-product-collection wc-block-product-collection--${t.displayStyle}`,children:i?(0,n.jsx)("p",{children:__("Loading...","wenprise-product-collection")}):t.tagId?(0,n.jsx)(h,{block:"wenprise/product-collection",attributes:t}):(0,n.jsx)("p",{children:__("Please select a term in the sidebar settings","wenprise-product-collection")})})]})},save:function(){return null}})})();